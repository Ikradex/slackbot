var cleverbot = require("cleverbot.io"),
	uuid = require("uuid");

function CleverBot() {
	var UUID = uuid.v4();

	this.bot = new cleverbot("eUutLXeVMOxm7zw8", "bRa6VdCxkG9GoaFGsAIrIpunHnB4KRr9");
	this.bot.setNick(UUID);

	this.bot.create(function(err, session) {
		// poop
		console.log("CleverBot session \"" + UUID + "\" ready");
	});
}

CleverBot.prototype.handleRequest = function (req, res, next) {
	var botPayLoad = {
		text: ""
	};

	// get args
	var userText = req.body.text,
		queryStr = userText.split(":")[1];

	if(queryStr.trim()) {
		this.bot.ask(queryStr, function(err, resp) {
			botPayLoad.text = resp;

			return res.status(200).json(botPayLoad);
		});
	}
};

module.exports = CleverBot;