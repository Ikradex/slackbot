var request = require("request");

function PuppyBot() {}

PuppyBot.prototype.handleRequest = function (req, res, next) {
	// get args
	var userText = req.body.text,
		argsStr = userText.split(":")[1];

	if (argsStr.trim()) {
		var args = argsStr.split(" ");

		var command = args[0] || ""

		switch (command) {
		case "pic":
			var breed = args[1] || ""
			if(breed.trim()) {
				this.pic(res, breed);
			} else {
				this.pic(res);
			}
		default:
			//return res.status(404).send("Not found");
			break;
		}
	}
};

PuppyBot.prototype.pic = function (res, breed) {
	var botPayload = {
			text: ""
		};

	var url = "http://www.thepuppyapi.com/puppy";

	if(breed) url += "?breed=" + breed;

	request({
		url: url,
		json: true
	}, function (error, resp, body) {
		if (!error && resp.statusCode === 200) {
			botPayload.text = body.puppy_url;

			return res.status(200).json(botPayload);
		} else {
			return res.status(404).end();
		}
	})
};

module.exports = PuppyBot;