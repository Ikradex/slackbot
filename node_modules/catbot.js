var request = require("request");

function CatBot() {
	this.purr = function (req, res, next) {
		return res.status(200).json({
			text: "purrrrr"
		});
	}

	this.pic = function (req, res, next) {
		var botPayload = {
			text: ""
		}

		var type = req.query.type || "jpg"

		console.log(type);

		request({
			url: "http://thecatapi.com/api/images/get?format=html&type=" + type
		}, function (error, resp, body) {
			if (!error && resp.statusCode === 200) {
				var regex = /src\s*=\s*"(.+?)"/;
				var src = regex.exec(body)[1];

				botPayload.text = src

				console.log(src);

				return res.status(200).json(botPayload);
			}
		})
	}

	this.fact = function (req, res, next) {
		var botPayload = {
			text: ""
		};

		request({
			url: "http://catfacts-api.appspot.com/api/facts",
			json: true
		}, function (error, resp, body) {
			if (!error && resp.statusCode === 200) {
				var fact = body.facts[0];

				botPayload.text = fact;

				return res.status(200).json(botPayload);
			}
		})
	}
}

module.exports = CatBot;